---
- name: Dateien auf Desktop übertragen
  hosts: INFacerWLAN
  remote_user: root
  environment:
    ANSIBLE_HOST_KEY_CHECKING: "False"
  tasks:
    - name: Bestimme den aktuell angemeldeten Benutzer
      shell: who | awk '{print $1}' | grep -v root | sort | uniq
      register: logged_in_users

    - name: Setze den Desktop-Benutzer (erster Benutzer in der Liste)
      set_fact:
        desktop_user: "{{ logged_in_users.stdout_lines[0] }}"

    - name: Bestimme das Home-Verzeichnis des aktuell angemeldeten Benutzers
      command: echo $HOME
      register: home_directory
      environment:
        HOME: "/tmp/{{ desktop_user }}"

    - name: Überprüfe, ob die .ipynb Datei bereits existiert
      stat:
        path: "/tmp/{{ desktop_user }}/Schreibtisch/2024-12-05_klausur_IF11BC_python.ipynb"
      register: ipynb_file

    - name: Übertrage die .ipynb Datei auf den Desktop des aktuell angemeldeten Benutzers
      copy:
        src: /home/mlo/Dokumente/02_schule/00_SJ2024-25/10_Informatik/INF11BC/2024-12-05_klausur_IF11BC_python.ipynb  # Pfad zur Datei auf deinem lokalen Rechner
        dest: "/tmp/{{ desktop_user }}/Schreibtisch/2024-12-05_klausur_IF11BC_python.ipynb"  # Pfad auf dem Desktop des Benutzers
      when: not ipynb_file.stat.exists

    - name: Übertrage die .pdf Datei auf den Desktop des aktuell angemeldeten Benutzers
      copy:
        src: /home/mlo/Dokumente/02_schule/00_SJ2024-25/10_Informatik/INF11BC/2024-12-05_klausur_IF11BC_python.pdf  # Pfad zur Datei auf deinem lokalen Rechner
        dest: "/tmp/{{ desktop_user }}/Schreibtisch/2024-12-05_klausur_IF11BC_python.pdf"  # Pfad auf dem Desktop des Benutzers

    - name: Ändere den Besitzer der .ipynb Datei
      file:
        path: "/tmp/{{ desktop_user }}/Schreibtisch/2024-12-05_klausur_IF11BC_python.ipynb"
        owner: "{{ desktop_user }}"
        group: "{{ desktop_user }}"
        state: file

    - name: Ändere den Besitzer der .pdf Datei
      file:
        path: "/tmp/{{ desktop_user }}/Schreibtisch/2024-12-05_klausur_IF11BC_python.pdf"
        owner: "{{ desktop_user }}"
        group: "{{ desktop_user }}"
        state: file
